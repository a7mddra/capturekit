# GitHub Actions Workflow for building CaptureKit on macOS for Intel and Apple Silicon
# This workflow uses the provided PKGBUILD bash script to perform the build and deployment.

name: macOS Build & Deploy

on:
  push:

jobs:
  build-and-deploy-macos:
    name: Build for macOS (${{ matrix.arch }})
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        include:
          - os: macos-14
            arch: arm64
          - os: macos-13
            arch: x86_64

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Qt
        uses: jurplel/install-qt-action@v4
        with:
          # Use the same Qt version as specified in the PKGBUILD script
          version: '6.6.0'
          host: 'mac'

      - name: Make PKGBUILD executable
        run: chmod +x PKGBUILD

      - name: Run build and package script
        run: ./PKGBUILD

      - name: Rename Artifact
        run: mv dist/capturekit.dmg dist/CaptureKit-macOS-${{ matrix.arch }}.dmg

      - name: Upload macOS Artifact
        uses: actions/upload-artifact@v4
        with:
          name: CaptureKit-macOS-${{ matrix.arch }}
          path: dist/CaptureKit-macOS-${{ matrix.arch }}.dmg